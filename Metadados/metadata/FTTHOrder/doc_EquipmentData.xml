<?xml version="1.0" encoding="UTF-8" ?>
<document name="FTTHOrder.EquipmentData">
  <dbSchema>ORDER</dbSchema>
  <description><![CDATA[
    <p style="margin-top: 0">
      Document respons&#225;vel por manter os dados dos equipamentos que foram
      instalados/retirados/modificados no cliente
    </p>
  ]]></description>
  <extends>doc_com.conceptwave.system.Document</extends>
  <generatedKey>true</generatedKey>
  <guid>{ed2b77d8-6ed5-4c9f-aaa1-5b2cc41d2dab}</guid>
  <label>Equipment Data</label>
  <metaVersion>3</metaVersion>
  <variableList>
    <variable name="acao" type="leaf">
      <column>ACAO</column>
      <label>acaoType</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHOrderManagementInterface.acaoType</valueType>
    </variable>
    <variable name="atividade" type="leaf">
      <column>ATIVIDADE</column>
      <label>Nome da Atividade</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.nomeAtividade</valueType>
    </variable>
    <variable name="codEquipamento" type="leaf">
      <column>CODEQUIPAMENTO</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHInventorySAPInterface.char18</valueType>
    </variable>
    <variable name="codOperacao" type="leaf">
      <column>CODOPERACAO</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_cwf.String64</valueType>
    </variable>
    <variable name="cwDocId" type="leaf">
      <column>CWDOCID</column>
      <key>1</key>
      <label>System document ID</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_cwf.cwDocId</valueType>
    </variable>
    <variable name="cwOrderId" type="leaf">
      <column>CWORDERID</column>
      <label>System order ID</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_cwf.cwOrderId</valueType>
    </variable>
    <variable name="cwParentId" type="leaf">
      <column>CWPARENTID</column>
      <label>System parent ID</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_cwf.cwParentId</valueType>
    </variable>
    <variable name="deviceGUID" type="leaf">
      <column>DEVICEGUID</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.deviceGUID</valueType>
    </variable>
    <variable name="errorMessage" type="leaf">
      <dontMap>true</dontMap>
      <valueType>dtype_FTTHOrder.errorMessage</valueType>
    </variable>
    <variable name="flagDadoOriginal" type="leaf">
      <column>IND_DADO_ORIGINAL</column>
      <label>flagDadoOriginal</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.flagDadoOriginal</valueType>
    </variable>
    <variable name="flgValidado" type="leaf">
      <column>FLGVALIDADO</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_com.conceptwave.system.Boolean</valueType>
    </variable>
    <variable name="foiDevolvidoSetTopBox" type="leaf">
      <column>IND_SETTOPBOX_DEVOLVIDO</column>
      <label>Devolvido?</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.foiDevolvido</valueType>
    </variable>
    <variable name="idAtivo" type="leaf">
      <column>IDATIVO</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.string100</valueType>
    </variable>
    <variable name="identificadorIPTV" type="leaf">
      <column>IDENTIFICADORIPTV</column>
      <label>Identificador IPTV</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.identificadorIPTV</valueType>
    </variable>
    <variable name="instalado" type="leaf">
      <column>INSTALADO</column>
      <label>Ponto Instalado?</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.instalado</valueType>
    </variable>
    <variable name="isNETWIN" type="leaf">
      <column>ISNETWIN</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_cwt_common.booleanCheckBox</valueType>
    </variable>
    <variable name="isProcessando" type="leaf">
      <column>ISPROCESSANDO</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_com.conceptwave.system.Boolean</valueType>
    </variable>
    <variable name="isSAP" type="leaf">
      <column>ISSAP</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_cwt_common.booleanCheckBox</valueType>
    </variable>
    <variable name="lastUpdatedDate" type="leaf">
      <column>LASTUPDATEDDATE</column>
      <label>System last updated timestamp</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_cwf.lastUpdatedDate</valueType>
    </variable>
    <variable name="motivoSetTopBox" type="leaf">
      <column>DESC_MOTIVO_SETTOPBOX</column>
      <label>Motivo</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.motivo</valueType>
    </variable>
    <variable name="nomeCPE" type="leaf">
      <column>NOMECPE</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHOrder.nomeCPEIsTV</valueType>
    </variable>
    <variable name="numeroSerieSetTopBox" type="leaf">
      <column>NUM_SERIE_SETTOPBOX</column>
      <label>Numero de Serie Set-Top Box</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.numeroSerieSetTopBox</valueType>
    </variable>
    <variable name="possuiDVRIntegrado" type="leaf">
      <column>IND_POSSUI_DVR_INTEGRADO</column>
      <label>Possui DVR Integrado?</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.possuiDVRIntegrado</valueType>
    </variable>
    <variable name="sendStbToSisStatus" type="leaf">
      <column>SENDSTBTOSISSTATUS</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.sendStbToSisStatus</valueType>
    </variable>
    <variable name="statusAcao" type="leaf">
      <column>STATUSACAO</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.statusAcao</valueType>
    </variable>
    <variable name="tipoPontoSTB" type="leaf">
      <dontMap>true</dontMap>
      <valueType>dtype_FTTHOrder.tipoPontoSTB</valueType>
    </variable>
    <variable name="tipoTV" type="leaf">
      <column>TIPOTV</column>
      <label>Tipo TV</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.tipoTV</valueType>
    </variable>
    <variable name="updatedBy" type="leaf">
      <column>UPDATEDBY</column>
      <label>System updated by</label>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_cwf.updatedBy</valueType>
    </variable>
    <variable name="numeroSerieSetTopBox_Original" type="leaf">
      <column>NUMEROSERIESETTOPBOX_ORIGINAL</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHClickInterface.numeroSerieEquipamento</valueType>
    </variable>
    <variable name="nomeCPE_Original" type="leaf">
      <column>NOMECPE_ORIGINAL</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHOrder.nomeCPE</valueType>
    </variable>
    <variable name="deviceGUID_Original" type="leaf">
      <column>DEVICEGUID_ORIGINAL</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHClickInterface.deviceGUID</valueType>
    </variable>
    <variable name="codEquipamento_Original" type="leaf">
      <column>CODEQUIPAMENTO_ORIGINAL</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHInventorySAPInterface.char18</valueType>
    </variable>
    <variable name="codOperacao_Original" type="leaf">
      <column>CODOPERACAO_ORIGINAL</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_cwf.String64</valueType>
    </variable>
    <variable name="foiDevolvidoSetTopBox_Original" type="leaf">
      <column>FOIDEVOLVIDOSETTOPBOX_ORIGINAL</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_FTTHCommon.foiDevolvido</valueType>
    </variable>
    <variable name="cpeHasChanged" type="leaf">
      <column>CPEHASCHANGED</column>
      <table>TBI_EQUIPAMENTO_PONTA</table>
      <valueType>dtype_com.conceptwave.system.Boolean</valueType>
    </variable>
  </variableList>
  <methodList>
    <method name="cwLeafInitAction$foiDevolvidoSetTopBox_Original" type="laction">
      <path>doc_FTTHOrder.EquipmentData/leaf_foiDevolvidoSetTopBox_Original</path>
      <type>initializer</type>
      <valueType>doc_FTTHOrder.EquipmentData/leaf_foiDevolvidoSetTopBox_Original</valueType>
      <script>false;</script>
    </method>
    <method name="cwLeafInitAction$cpeHasChanged" type="laction">
      <path>doc_FTTHOrder.EquipmentData/leaf_cpeHasChanged</path>
      <type>initializer</type>
      <valueType>doc_FTTHOrder.EquipmentData/leaf_cpeHasChanged</valueType>
      <script>false;</script>
    </method>
    <method name="cwLeafInitAction$flgValidado" type="laction">
      <path>doc_FTTHOrder.EquipmentData/leaf_flgValidado</path>
      <type>initializer</type>
      <script>false</script>
    </method>
    <method name="cwLeafInitAction$isProcessando" type="laction">
      <path>doc_FTTHOrder.EquipmentData/leaf_isProcessando</path>
      <type>initializer</type>
      <script>false</script>
    </method>
    <method name="cwLeafInitAction$codOperacao" type="laction">
      <path>doc_FTTHOrder.EquipmentData/leaf_codOperacao</path>
      <type>initializer</type>
      <script><![CDATA['Consulta']]></script>
    </method>
    <method name="cwLeafInitAction$statusAcao" type="laction">
      <path>doc_FTTHOrder.EquipmentData/leaf_statusAcao</path>
      <type>initializer</type>
      <script><![CDATA['pendente']]></script>
    </method>
    <method name="setTopBoxPermission" type="permMethod">
      <script><![CDATA[
        var ord = this.order;

        if(ord.EquipmentData && ord.EquipmentData[0].AddPointsEquipmentData && ord.EquipmentData[0].AddPointsEquipmentData.length > 1)
        {
            if(this.possuiDVRIntegrado || (ord.OrderHeader.listaSolicitacoes.indexOf('Mudança de Endereço') > -1 && this.acao == '-'))
                return false;
            if(!this.instalado)
                return true;
            var naoInstalado = 0;
            for(var i=0; i < ord.EquipmentData[0].AddPointsEquipmentData.length; i++)
            {
                if(this.identificadorIPTV != ord.EquipmentData[0].AddPointsEquipmentData[i].EquipmentPointData.identificadorIPTV
                && !ord.EquipmentData[0].AddPointsEquipmentData[i].EquipmentPointData.instalado)
                    naoInstalado++;
            }
            return !(naoInstalado == (ord.EquipmentData[0].AddPointsEquipmentData.length - 1));
        }

        return false;
      ]]></script>
    </method>
    <method name="cwfSaveView" type="permMethod">
      <script><![CDATA[
        //this.cw$super_cwfSaveView($psCondition);
        if (this.parent == null)
            return false;

        return true;
      ]]></script>
    </method>
  </methodList>
  <UserInterface name="UserInterface" type="ui">
    <extends>doc_com.conceptwave.system.Document/ui_UserInterface</extends>
    <variableList>
      <variable name="model" type="uivar">
        <label>model</label>
        <valueType>doc_FTTHOrder.EquipmentData</valueType>
      </variable>
      <variable name="CPEValidationStatusFinderUI" type="leaf">
        <valueType>findDoc_FTTHOrder.CPEValidationStatusFinder/ui_UserInterface</valueType>
      </variable>
      <variable name="changeCPEGridFinderUI" type="leaf">
        <valueType>findDoc_FTTHOrder.changeCPEGridFinder/ui_UserInterface</valueType>
      </variable>
    </variableList>
    <vformList>
      <vform name="Forms" type="frmui">
        <extends>doc_com.conceptwave.system.Document/ui_UserInterface/frmui_Forms</extends>
        <overlayList>
          <overlay name="Default" type="exov">
            <base>ui_com.conceptwave.system.DocumentUserInterface/frmui_Forms/exov_Default</base>
            <extends>ui_com.conceptwave.system.DocumentUserInterface/frmui_Forms/exov_Default</extends>
            <label>Default</label>
            <overrideList>
              <override name="aaaGrid_vCentering" type="elvltstck">
                <height>100%</height>
                <membersMargin>5</membersMargin>
                <width>100%</width>
                <elementList>
                  <element name="STBOriginalData" type="elgrd">
                    <alignment>left,center</alignment>
                    <colWidths>250px</colWidths>
                    <membersMargin>5</membersMargin>
                    <numOfCols>3</numOfCols>
                    <showEdge>true</showEdge>
                    <useDefaultHeight>true</useDefaultHeight>
                    <width>100%</width>
                    <elementList>
                      <element name="EquipmentDataHeaderOriginal" type="elhdr">
                        <label>Dados do Equipamento Instalado no Cliente</label>
                      </element>
                      <element name="RowSpacer5" type="elrsp">
                        <height>1px</height>
                        <rowSpan>1px</rowSpan>
                      </element>
                      <element name="numeroSerieSetTopBox_Original" type="elfld">
                        <columnSpan>0</columnSpan>
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_numeroSerieSetTopBox_Original</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="foiDevolvidoSetTopBox_Original" type="elrgrp">
                        <defaultEnum>yes/no</defaultEnum>
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_isNotNewEquip</variablePath>
                          </variablePathList>
                        </editable>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_foiDevolvidoSetTopBox_Original</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="motivoSetTopBox" type="elfld">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_isNotNewEquip</variablePath>
                          </variablePathList>
                        </editable>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_motivoSetTopBox</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="RowSpacer" type="elrsp">
                        <height>1px</height>
                        <rowSpan>1px</rowSpan>
                      </element>
                      <element name="codOperacao1" type="elfld">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Código da Operação</label>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_codOperacao</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="nomeCPE_Original" type="elslct">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Nome do CPE</label>
                        <onChangeMethod type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uimthd_onUpdateNomeCPE</variablePath>
                          </variablePathList>
                        </onChangeMethod>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_nomeCPE_Original</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="codEquipamento_Original" type="elfld">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Código do Equipamento</label>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_codEquipamento_Original</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="RowSpacer2" type="elrsp">
                        <height>1px</height>
                        <rowSpan>1px</rowSpan>
                      </element>
                      <element name="deviceGUID_Original" type="elfld">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_isNotDetalhamento</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Device GUID</label>
                        <startRow>true</startRow>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_deviceGUID_Original</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="possuiDVRIntegradoOriginal" type="elrgrp">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_possuiDVRIntegrado</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                    </elementList>
                  </element>
                  <element name="LayoutSpacer" type="ellsp">
                    <height>1px</height>
                  </element>
                  <element name="STBNewData" type="elgrd">
                    <alignment>left,center</alignment>
                    <colWidths>250px</colWidths>
                    <membersMargin>5</membersMargin>
                    <numOfCols>3</numOfCols>
                    <showEdge>true</showEdge>
                    <useDefaultHeight>true</useDefaultHeight>
                    <width>100%</width>
                    <elementList>
                      <element name="EquipmentDataHeader" type="elhdr">
                        <label>Dados do Equipamento a Instalar no Cliente</label>
                      </element>
                      <element name="RowSpacer6" type="elrsp">
                        <height>1px</height>
                        <rowSpan>1px</rowSpan>
                      </element>
                      <element name="numeroSerieSetTopBox" type="elfld">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_InstallRemoveEquipmentPermission</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Numero de Serie Set-Top Box</label>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_numeroSerieSetTopBox</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="nomeCPE" type="elslct">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_InstallRemoveEquipmentPermission</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Nome do CPE</label>
                        <onChangeMethod type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uimthd_onUpdateNomeCPE</variablePath>
                          </variablePathList>
                        </onChangeMethod>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_nomeCPE</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="codEquipamento" type="elfld">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Código do Equipamento</label>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_codEquipamento</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="RowSpacer3" type="elrsp">
                        <height>1px</height>
                        <rowSpan>1px</rowSpan>
                      </element>
                      <element name="deviceGUID" type="elfld">
                        <editable type="varPath">
                          <independant>true</independant>
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_InstallRemoveEquipmentPermission</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Device GUID</label>
                        <startRow>true</startRow>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_deviceGUID</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="possuiDVRIntegrado" type="elrgrp">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_possuiDVRIntegrado</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="instalado" type="elrgrp">
                        <defaultEnum>yes/no</defaultEnum>
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/permMethod_setTopBoxPermission</variablePath>
                          </variablePathList>
                        </editable>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_instalado</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="RowSpacer4" type="elrsp">
                        <height>1px</height>
                        <rowSpan>1px</rowSpan>
                      </element>
                      <element name="codOperacao" type="elfld">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Código da Operação</label>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_codOperacao</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="isSAP1" type="elchk">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Consulta SAP</label>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_isSAP</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                      <element name="isNETWIN1" type="elchk">
                        <editable type="varPath">
                          <variablePathList>
                            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                          </variablePathList>
                        </editable>
                        <label>Atualizar Inventário</label>
                        <labelOrientation>top</labelOrientation>
                        <variable type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uivar_model</variablePath>
                            <variablePath>doc_FTTHOrder.EquipmentData/leaf_isNETWIN</variablePath>
                          </variablePathList>
                        </variable>
                      </element>
                    </elementList>
                  </element>
                  <element name="actionButtons" type="elgrd">
                    <numOfCols>5</numOfCols>
                    <width>521px</width>
                    <elementList>
                      <element name="validarCPE" type="elbtn">
                        <clickMethod type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/usrActionMethod_validarCPE</variablePath>
                          </variablePathList>
                        </clickMethod>
                        <label>Validar CPE</label>
                        <visible type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_associarCPEPermission</variablePath>
                          </variablePathList>
                        </visible>
                      </element>
                      <element name="associarCPE" type="elbtn">
                        <autofit>true</autofit>
                        <clickMethod type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/usrActionMethod_associarCPE</variablePath>
                          </variablePathList>
                        </clickMethod>
                        <columnSpan>0</columnSpan>
                        <label>Associar CPE</label>
                        <visible type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_associarCPEPermission</variablePath>
                          </variablePathList>
                        </visible>
                      </element>
                      <element name="trocaCPE" type="elbtn">
                        <clickMethod type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/usrActionMethod_trocarCPE</variablePath>
                          </variablePathList>
                        </clickMethod>
                        <columnSpan>0</columnSpan>
                        <disabled type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_permTrocaCPE</variablePath>
                          </variablePathList>
                        </disabled>
                        <label>Trocar CPE</label>
                        <padding>0</padding>
                        <visible type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/permMethod_trocarCPEPermission</variablePath>
                          </variablePathList>
                        </visible>
                      </element>
                      <element name="refresh" type="elbtn">
                        <clickMethod type="varPath">
                          <variablePathList>
                            <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/uimthd_refreshCPEChangeGrid</variablePath>
                          </variablePathList>
                        </clickMethod>
                        <label>Refresh</label>
                      </element>
                    </elementList>
                  </element>
                  <element name="CPEChangeGrid" type="elovf">
                    <formReference type="varPath">
                      <variablePathList>
                        <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/leaf_changeCPEGridFinderUI</variablePath>
                        <variablePath>findDoc_FTTHOrder.changeCPEGridFinder/ui_UserInterface/frmui_Forms</variablePath>
                        <variablePath>findDoc_FTTHOrder.changeCPEGridFinder/ui_UserInterface/frmui_Forms/exov_Result</variablePath>
                      </variablePathList>
                    </formReference>
                    <height>200px</height>
                    <variable type="varPath">
                      <variablePathList>
                        <variablePath>doc_FTTHOrder.EquipmentData/ui_UserInterface/leaf_changeCPEGridFinderUI</variablePath>
                      </variablePathList>
                    </variable>
                  </element>
                </elementList>
              </override>
            </overrideList>
          </overlay>
          <overlay name="Menu" type="exov">
            <base>doc_com.conceptwave.system.Document/ui_UserInterface/frmui_Forms/exov_Menu</base>
            <extends>doc_com.conceptwave.system.Document/ui_UserInterface/frmui_Forms/exov_Menu</extends>
            <label>Menu</label>
            <overrideList>
              <override name="cwfSave" type="elext"/>
              <override name="hl1" type="elext"/>
            </overrideList>
          </overlay>
        </overlayList>
      </vform>
    </vformList>
    <methodList>
      <method name="onInit" type="action">
        <valueType>nmeta_com.conceptwave.system.Object</valueType>
        <script><![CDATA[
          this.cw$super_onInit();


          this.changeCPEGridFinderUI = new FTTHOrder.changeCPEGridFinder.UserInterface(null, this);
          this.changeCPEGridFinderUI.model.searchDocument.cwOrderId = this.model.order.id;
          this.changeCPEGridFinderUI.model.searchDocument.idAtivo = this.model.idAtivo;
          this.refreshCPEChangeGrid();
        ]]></script>
      </method>
      <method name="validarCPE" type="usrActionMethod">
        <confirmation>doc_FTTHOrder.EquipmentData/ui_UserInterface/uimthd_validarCPE_confirm</confirmation>
        <dialogHeight>800</dialogHeight>
        <dialogWidth>700</dialogWidth>
        <showInPopup>true</showInPopup>
        <script><![CDATA[
          FTTHOrder.execValidateProcess("Validar CPE", "STB", this.model, UserProfile.getUserTask());
          this.model.isNETWIN = false;
          this.model.isSAP = false;
          this.model.save();
        ]]></script>
      </method>
      <method name="validarCPE_confirm" type="uimthd">
        <script><![CDATA[
          if(!this.model.numeroSerieSetTopBox){
             Global.throwException("Campo numeroSerieSetTopBox não preenchido");
          }

          if(!this.model.codEquipamento){
              Global.throwException("Campo Código Equipamento não preenchido");
          }
          var ord = Order.getOrderById(this.model.cwOrderId);



          if(!ord.ManualActivityData[ord.ManualActivityData.length -1].ManualActivityData.codigoPSR){
              Global.throwException("Campo Código da PSR não preenchido");
          }

          return null;
        ]]></script>
      </method>
      <method name="associarCPE" type="usrActionMethod">
        <confirmation>doc_FTTHOrder.EquipmentData/ui_UserInterface/uimthd_associarCPE_confirm</confirmation>
        <script><![CDATA[
          if (FTTHOrder.isEquipmentLocked(this.model.idAtivo, 'STB', this.model.cwOrderId)) {
              Global.showUserMessage("O processo já foi iniciado. Por favor aguarde.");
              FTTHOrder.refreshForm(this.model);
              FTTHOrder.refreshGrid(this.model, "STB", this.changeCPEGridFinderUI);
          } else {
              FTTHOrder.execValidateProcess("Associar CPE", "STB", this.model, UserProfile.getUserTask());
              this.model.isNETWIN = false;
              this.model.isSAP = false;
              this.model.save();
          }
        ]]></script>
      </method>
      <method name="associarCPE_confirm" type="uimthd">
        <script><![CDATA[
          if(!this.model.numeroSerieSetTopBox){
             Global.throwException("Campo numeroSerieSetTopBox não preenchido");
          }

          if(!this.model.codEquipamento){
              Global.throwException("Campo Código Equipamento não preenchido");
          }
          var ord = Order.getOrderById(this.model.cwOrderId);

          if(!ord.ManualActivityData[ord.ManualActivityData.length -1].ManualActivityData.codigoPSR){
              Global.throwException("Campo Código da PSR não preenchido");
          }

          if(this.model.numeroSerieSetTopBox == this.model.numeroSerieSetTopBox_Original){
            Global.throwException("Números de série, não podem ser iguais");
          }


          var orderType = ord.OrderHeader.tipoOS;

          if(orderType == "TIPO_ORDEM_RETIRADA"){
              Global.throwException("Operação não permitida para este tipo de ordem");
          }

          return null;
        ]]></script>
      </method>
      <method name="trocarCPE" type="usrActionMethod">
        <confirmation>doc_FTTHOrder.EquipmentData/ui_UserInterface/uimthd_associarCPE_confirm</confirmation>
        <dialogHeight>800</dialogHeight>
        <dialogWidth>700</dialogWidth>
        <showInPopup>true</showInPopup>
        <script><![CDATA[
          if (FTTHOrder.isEquipmentLocked(this.model.idAtivo, 'STB', this.model.cwOrderId)) {
              Global.showUserMessage("O processo já foi iniciado. Por favor aguarde.")
              FTTHOrder.refreshForm(this.model);
              FTTHOrder.refreshGrid(this.model, "STB", this.changeCPEGridFinderUI);
          } else {
              FTTHOrder.execValidateProcess("Trocar CPE", "STB", this.model, UserProfile.getUserTask());
              this.model.isNETWIN = false;
              this.model.isSAP = false;
              this.model.save();
          }

          //FTTHOrder.refreshForm(this.model);
          //FTTHOrder.refreshGrid(this.model, "STB", this.changeCPEGridFinderUI);
        ]]></script>
      </method>
      <method name="associarCPEPermission" type="permMethod">
        <script><![CDATA[
          var ord = Order.getOrderById(this.model.cwOrderId);
          var actualTask = UserProfile.getUserTask();
          var isNewData =  false;

          if (this.model.flagDadoOriginal=="N"){
              isNewData =  true;
          }

          var isMudancaEndereco = false;

          if(FTTHCommon.getOrderType(this.model.cwOrderId) == "MUDANCA_ENDERECO"){
              isMudancaEndereco = true;
          }


          if(isMudancaEndereco && isNewData){
              return false;
          }

          switch(actualTask) {
              case "FTTHUserInterface.InstallRemoveEquipmentManualTaskInterface/InstallRemoveEquipmentTask":
                  return (isNewData) ? ((!hasAssociationHappened(this) && !this.model.cpeHasChanged) && !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId)) : false;
                  break;
              case "FTTHUserInterface.ClickManualActivityInterface/BAOpenningOperation":
                  return (isNewData) ? ((!hasAssociationHappened(this) && !this.model.cpeHasChanged) && !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId)) : false;
                  break;
              case "FTTHUserInterface.SGFTManualActivityInterface/SGFTBAOpenning":
                  return false;
                  break;
              default:
                  return false;
          }

          function hasAssociationHappened(self){
              var searchDoc = new Document('FTTHCommon.ActivityClick');
              searchDoc.operacao = 'Associar CPE';
              searchDoc.equipmentType = 'STB';
              searchDoc.equipmentId = self.model.idAtivo;
              searchDoc.cwOrderId = self.model.cwOrderId;
              searchDoc.status = 'SUCCESS';
              var result = Finder.runSearch('FTTHCommon:activityClickFinder', searchDoc);
              return (result.length == 2); //VALID + INVENT
          }
        ]]></script>
      </method>
      <method name="trocarCPEPermission" type="permMethod">
        <script><![CDATA[
          var ord = Order.getOrderById(this.model.cwOrderId);
          var actualTask = UserProfile.getUserTask();
          var isNewData =  false;

          if (this.model.flagDadoOriginal=="N"){
              isNewData =  true;

          }

          var cwOrderId = this.model.cwOrderId;

          var ops = new Document('FTTHOrderManagementInterface:OrderParametersSearch');
          ops.cwOrderId = cwOrderId;
          var isMudancaEndereco = false;
          var isExclusaoPonto   = false;

          var orderRequest = Finder.runSearch('FTTHOrderManagementInterface:OrderRequestFinder', ops);
          if (orderRequest.size > 0) {
              for (var i = 0; i < orderRequest.size; i++) {
                  var solicitacao = orderRequest[i];

                  if(solicitacao.idSolicitacao == "MUDANCA_ENDERECO"){
                      isMudancaEndereco = true;
                  }

                  if(solicitacao.tipoOrdemServico == 'TIPO_ORDEM_RETIRADA'){
                      return false;
                  }

                  if(solicitacao.idSolicitacao == "EXCLUSAO_PONTO_ADICIONAL"){
                      isExclusaoPonto = true;
                  }
              }
          }


          if(FTTHCommon.getOrderType(this.model.cwOrderId) == "MUDANCA_ENDERECO"){
              isMudancaEndereco = true;
          }

          if(isExclusaoPonto && this.model.acao == "remover"){
              return false;
          }

          if(isMudancaEndereco && isNewData){
              return false;
          }
          switch(actualTask) {
              case "FTTHUserInterface.InstallRemoveEquipmentManualTaskInterface/InstallRemoveEquipmentTask":
                  return (isNewData) ? ( (hasAssociationHappened(this) || this.model.cpeHasChanged) && !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId)) : !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId);
                  break;
              case "FTTHUserInterface.ClickManualActivityInterface/BAOpenningOperation":
                  return (isNewData) ? ( (hasAssociationHappened(this) || this.model.cpeHasChanged) && !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId)) : !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId);
                  break;
              case "FTTHUserInterface.SGFTManualActivityInterface/SGFTBAOpenning":
                  return !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId);
                  break;
              default:
                  return false;
          }

          function hasAssociationHappened(self) {
              var searchDoc = new Document('FTTHCommon.ActivityClick');
              searchDoc.operacao = 'Associar CPE';
              searchDoc.equipmentType = 'STB';
              searchDoc.equipmentId = self.model.idAtivo;
              searchDoc.cwOrderId = self.model.cwOrderId;
              searchDoc.status = 'SUCCESS';
              var result = Finder.runSearch('FTTHCommon:activityClickFinder', searchDoc);
              return (result.length == 2); //VALID + INVENT
          }
        ]]></script>
      </method>
      <method name="InstallRemoveEquipmentPermission" type="permMethod">
        <script><![CDATA[
          var ord = Order.getOrderById(this.model.cwOrderId);
          var actualTask = UserProfile.getUserTask();
          var cwOrderId = this.model.cwOrderId;
          var orderType = ord.OrderHeader.tipoOS;
          var isNewData =  false;

          if (this.model.flagDadoOriginal=="N"){
              isNewData =  true;
          }

          var ops = new Document('FTTHOrderManagementInterface:OrderParametersSearch');
          ops.cwOrderId = cwOrderId;
          var isMudancaEndereco = false;
          var isExclusaoPonto   = false;

          var orderRequest = Finder.runSearch('FTTHOrderManagementInterface:OrderRequestFinder', ops);
          if (orderRequest.size > 0) {
              for (var i = 0; i < orderRequest.size; i++) {
                  var solicitacao = orderRequest[i];

                  if(solicitacao.idSolicitacao == "MUDANCA_ENDERECO"){
                      isMudancaEndereco = true;
                  }

                  if(solicitacao.tipoOrdemServico == 'TIPO_ORDEM_RETIRADA'){
                      return false;
                  }

                  if(solicitacao.idSolicitacao == "EXCLUSAO_PONTO_ADICIONAL"){
                      isExclusaoPonto = true;
                  }
              }
          }

          if(FTTHCommon.getOrderType(this.model.cwOrderId) == "MUDANCA_ENDERECO"){
              isMudancaEndereco = true;
          }

          if(isExclusaoPonto && this.model.acao == "remover"){
              return false;
          }

          if(isMudancaEndereco && isNewData){
              return false;
          }




          switch(actualTask) {
              case "FTTHUserInterface.InstallRemoveEquipmentManualTaskInterface/InstallRemoveEquipmentTask":
                  return !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId);
                  break;
              case "FTTHUserInterface.ClickManualActivityInterface/BAOpenningOperation":
                  return !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId);
                  break;
              case "FTTHUserInterface.SGFTManualActivityInterface/SGFTBAOpenning":
                  return !FTTHOrder.isEquipmentLocked(this.model.idAtivo, "STB", this.model.cwOrderId);
                  break;
              default:
                  return false;
          }
        ]]></script>
      </method>
      <method name="fieldActivityPermission" type="permMethod">
        <script><![CDATA[
          var actualTask = UserProfile.getUserTask();

          switch(actualTask) {
              case "FTTHUserInterface.InstallRemoveEquipmentManualTaskInterface/InstallRemoveEquipmentTask":
                  return true;
                  break;
              case "FTTHUserInterface.ClickManualActivityInterface/BAOpenningOperation":
                  return true;
                  break;
              case "FTTHUserInterface.SGFTManualActivityInterface/SGFTBAOpenning":
                  return true;
                  break;
              default:
                  return false;
          }
        ]]></script>
      </method>
      <method name="refreshCPEChangeGrid" type="uimthd">
        <script><![CDATA[
          FTTHOrder.refreshForm(this.model);
          FTTHOrder.refreshGrid(this.model, "STB", this.changeCPEGridFinderUI);
        ]]></script>
      </method>
      <method name="onUpdateNomeCPE" type="uimthd">
        <script><![CDATA[
          var searchDoc = new Document("FTTHReportApplication:registerCPE");

          searchDoc.cwDocId = this.model.nomeCPE;

          var result = Finder.runSearch("FTTHOrder:nomeCPEFinderIsTV", searchDoc);


          this.model.codEquipamento = result[0].codigoMaterial;
        ]]></script>
      </method>
      <method name="permTrocaCPE" type="permMethod">
        <script><![CDATA[
          var userId = Global.getUserId();

          var searchUser = new Document('cwf_up:userProfileSearch');
          searchUser.userId = userId;
          var privileges = Finder.runSearch('FTTHOrder:UserPrivileges', searchUser);

          if(privileges && privileges.length > 0){
            for(var i= 0; privileges.length > i; i++){
                if(privileges[i].privilegeCode == 'ChangeCPE'){
                    return false;
                }
            }
          }
          return true;
        ]]></script>
      </method>
      <method name="isNotNewEquip" type="permMethod">
        <script><![CDATA[
          var actualTask = UserProfile.getUserTask();

          if(actualTask == null){
              //No detalhamento o actualTask da ordem vem nulo.
              return false;
          }
          var ord = Order.getOrderById(this.model.cwOrderId);
          var orderType = ord.OrderHeader.tipoOS;

          if(orderType == "TIPO_ORDEM_INSTALACAO" || this.model.flagDadoOriginal == "N"){
              return false;
          }
          return true;
        ]]></script>
      </method>
      <method name="isNotDetalhamento" type="permMethod">
        <script><![CDATA[
          var actualTask = UserProfile.getUserTask();

          if(actualTask == null){
              //No detalhamento o actualTask da ordem vem nulo.
              return false;
          }
          return true;
        ]]></script>
      </method>
    </methodList>
  </UserInterface>
</document>